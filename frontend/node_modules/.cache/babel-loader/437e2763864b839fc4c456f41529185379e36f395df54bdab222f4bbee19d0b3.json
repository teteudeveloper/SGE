{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Alert,Box,FormControl,InputLabel,Select,MenuItem,Button,TextField}from'@mui/material';import Layout from'../../components/Layout/Layout';import PageHeader from'../../components/Common/PageHeader';import DateRangeFilter from'../../components/Common/DateRangeFilter';import DataTable from'../../components/Common/DataTable';import LoadingSpinner from'../../components/Common/LoadingSpinner';import estoqueService from'../../services/estoqueService';import{formatDateTime}from'../../utils/formatters';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Estoque=()=>{const[movimentacoes,setMovimentacoes]=useState([]);const[filteredMovimentacoes,setFilteredMovimentacoes]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');// Filter states\nconst[produtoFilter,setProdutoFilter]=useState('');const[tipoFilter,setTipoFilter]=useState('');const[fromDate,setFromDate]=useState('');const[toDate,setToDate]=useState('');useEffect(()=>{const load=async()=>{try{const data=await estoqueService.listarMovimentacoes();setMovimentacoes(data||[]);}catch(err){setError('Erro ao carregar movimentações de estoque');}finally{setLoading(false);}};load();},[]);// Apply filters client-side\nuseEffect(()=>{let result=movimentacoes;// Filter by produto (nome ou código)\nif(produtoFilter.trim()){const term=produtoFilter.toLowerCase();result=result.filter(m=>(m.produtoNome||'').toLowerCase().includes(term)||(m.produtoCodigo||'').toLowerCase().includes(term));}// Filter by tipo (ENTRADA/SAIDA)\nif(tipoFilter){result=result.filter(m=>(m.tipo||'')===tipoFilter);}// Filter by date range\nif(fromDate){const from=new Date(fromDate);from.setHours(0,0,0,0);result=result.filter(m=>{const d=m.dataMovimentacao?new Date(m.dataMovimentacao):null;return d?d>=from:false;});}if(toDate){const to=new Date(toDate);to.setHours(23,59,59,999);result=result.filter(m=>{const d=m.dataMovimentacao?new Date(m.dataMovimentacao):null;return d?d<=to:false;});}setFilteredMovimentacoes(result);},[movimentacoes,produtoFilter,tipoFilter,fromDate,toDate]);const columns=[{field:'dataMovimentacao',headerName:'Data',render:value=>value?formatDateTime(value):'-'},{field:'produtoCodigo',headerName:'Código'},{field:'produtoNome',headerName:'Produto'},{field:'tipo',headerName:'Tipo'},{field:'quantidade',headerName:'Quantidade',align:'right'},{field:'motivo',headerName:'Motivo'},{field:'usuarioNome',headerName:'Usuário'}];if(loading){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(LoadingSpinner,{})});}return/*#__PURE__*/_jsxs(Layout,{children:[/*#__PURE__*/_jsx(PageHeader,{title:\"Movimenta\\xE7\\xF5es de Estoque\",subtitle:\"Entradas e sa\\xEDdas de estoque registradas automaticamente pelas vendas.\"}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",onClose:()=>setError(''),sx:{mb:2},children:error}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2,display:'flex',gap:2,flexWrap:'wrap',alignItems:'center'},children:[/*#__PURE__*/_jsx(DateRangeFilter,{from:fromDate,to:toDate,onChangeFrom:setFromDate,onChangeTo:setToDate,onApply:()=>{}// no-op, filters are reactive\n,onClear:()=>{setFromDate('');setToDate('');}}),/*#__PURE__*/_jsx(TextField,{size:\"small\",label:\"Produto (nome/c\\xF3digo)\",value:produtoFilter,onChange:e=>setProdutoFilter(e.target.value),placeholder:\"Digite para filtrar...\"}),/*#__PURE__*/_jsxs(FormControl,{size:\"small\",sx:{minWidth:160},children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Tipo\"}),/*#__PURE__*/_jsxs(Select,{value:tipoFilter,label:\"Tipo\",onChange:e=>setTipoFilter(e.target.value),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"Todos\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"ENTRADA\",children:\"Entrada\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"SAIDA\",children:\"Sa\\xEDda\"})]})]}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"small\",onClick:()=>{setProdutoFilter('');setTipoFilter('');setFromDate('');setToDate('');},children:\"Limpar\"})]}),/*#__PURE__*/_jsx(DataTable,{columns:columns,data:filteredMovimentacoes,actions:false})]});};export default Estoque;","map":{"version":3,"names":["React","useEffect","useState","Alert","Box","FormControl","InputLabel","Select","MenuItem","Button","TextField","Layout","PageHeader","DateRangeFilter","DataTable","LoadingSpinner","estoqueService","formatDateTime","jsx","_jsx","jsxs","_jsxs","Estoque","movimentacoes","setMovimentacoes","filteredMovimentacoes","setFilteredMovimentacoes","loading","setLoading","error","setError","produtoFilter","setProdutoFilter","tipoFilter","setTipoFilter","fromDate","setFromDate","toDate","setToDate","load","data","listarMovimentacoes","err","result","trim","term","toLowerCase","filter","m","produtoNome","includes","produtoCodigo","tipo","from","Date","setHours","d","dataMovimentacao","to","columns","field","headerName","render","value","align","children","title","subtitle","severity","onClose","sx","mb","display","gap","flexWrap","alignItems","onChangeFrom","onChangeTo","onApply","onClear","size","label","onChange","e","target","placeholder","minWidth","variant","onClick","actions"],"sources":["/home/teteu/Downloads/trabalho/sge/frontend/src/pages/Estoque/Estoque.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  Alert,\n  Box,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  Button,\n  TextField,\n} from '@mui/material';\n\nimport Layout from '../../components/Layout/Layout';\nimport PageHeader from '../../components/Common/PageHeader';\nimport DateRangeFilter from '../../components/Common/DateRangeFilter';\nimport DataTable from '../../components/Common/DataTable';\nimport LoadingSpinner from '../../components/Common/LoadingSpinner';\nimport estoqueService from '../../services/estoqueService';\nimport { formatDateTime } from '../../utils/formatters';\n\nconst Estoque = () => {\n  const [movimentacoes, setMovimentacoes] = useState([]);\n  const [filteredMovimentacoes, setFilteredMovimentacoes] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  \n  // Filter states\n  const [produtoFilter, setProdutoFilter] = useState('');\n  const [tipoFilter, setTipoFilter] = useState('');\n  const [fromDate, setFromDate] = useState('');\n  const [toDate, setToDate] = useState('');\n\n  useEffect(() => {\n    const load = async () => {\n      try {\n        const data = await estoqueService.listarMovimentacoes();\n        setMovimentacoes(data || []);\n      } catch (err) {\n        setError('Erro ao carregar movimentações de estoque');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    load();\n  }, []);\n\n  // Apply filters client-side\n  useEffect(() => {\n    let result = movimentacoes;\n\n    // Filter by produto (nome ou código)\n    if (produtoFilter.trim()) {\n      const term = produtoFilter.toLowerCase();\n      result = result.filter(\n        (m) =>\n          (m.produtoNome || '').toLowerCase().includes(term) ||\n          (m.produtoCodigo || '').toLowerCase().includes(term)\n      );\n    }\n\n    // Filter by tipo (ENTRADA/SAIDA)\n    if (tipoFilter) {\n      result = result.filter((m) => (m.tipo || '') === tipoFilter);\n    }\n\n    // Filter by date range\n    if (fromDate) {\n      const from = new Date(fromDate);\n      from.setHours(0, 0, 0, 0);\n      result = result.filter((m) => {\n        const d = m.dataMovimentacao ? new Date(m.dataMovimentacao) : null;\n        return d ? d >= from : false;\n      });\n    }\n\n    if (toDate) {\n      const to = new Date(toDate);\n      to.setHours(23, 59, 59, 999);\n      result = result.filter((m) => {\n        const d = m.dataMovimentacao ? new Date(m.dataMovimentacao) : null;\n        return d ? d <= to : false;\n      });\n    }\n\n    setFilteredMovimentacoes(result);\n  }, [movimentacoes, produtoFilter, tipoFilter, fromDate, toDate]);\n\n  const columns = [\n    {\n      field: 'dataMovimentacao',\n      headerName: 'Data',\n      render: (value) => (value ? formatDateTime(value) : '-'),\n    },\n    { field: 'produtoCodigo', headerName: 'Código' },\n    { field: 'produtoNome', headerName: 'Produto' },\n    { field: 'tipo', headerName: 'Tipo' },\n    { field: 'quantidade', headerName: 'Quantidade', align: 'right' },\n    { field: 'motivo', headerName: 'Motivo' },\n    { field: 'usuarioNome', headerName: 'Usuário' },\n  ];\n\n  if (loading) {\n    return (\n      <Layout>\n        <LoadingSpinner />\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout>\n      <PageHeader\n        title=\"Movimentações de Estoque\"\n        subtitle=\"Entradas e saídas de estoque registradas automaticamente pelas vendas.\"\n      />\n\n      {error && (\n        <Alert severity=\"error\" onClose={() => setError('')} sx={{ mb: 2 }}>\n          {error}\n        </Alert>\n      )}\n\n      {/* Filters bar - client-side only */}\n      <Box sx={{ mb: 2, display: 'flex', gap: 2, flexWrap: 'wrap', alignItems: 'center' }}>\n        <DateRangeFilter\n          from={fromDate}\n          to={toDate}\n          onChangeFrom={setFromDate}\n          onChangeTo={setToDate}\n          onApply={() => {}} // no-op, filters are reactive\n          onClear={() => { setFromDate(''); setToDate(''); }}\n        />\n\n        <TextField\n          size=\"small\"\n          label=\"Produto (nome/código)\"\n          value={produtoFilter}\n          onChange={(e) => setProdutoFilter(e.target.value)}\n          placeholder=\"Digite para filtrar...\"\n        />\n\n        <FormControl size=\"small\" sx={{ minWidth: 160 }}>\n          <InputLabel>Tipo</InputLabel>\n          <Select value={tipoFilter} label=\"Tipo\" onChange={(e) => setTipoFilter(e.target.value)}>\n            <MenuItem value=\"\">Todos</MenuItem>\n            <MenuItem value=\"ENTRADA\">Entrada</MenuItem>\n            <MenuItem value=\"SAIDA\">Saída</MenuItem>\n          </Select>\n        </FormControl>\n\n        <Button variant=\"outlined\" size=\"small\" onClick={() => { setProdutoFilter(''); setTipoFilter(''); setFromDate(''); setToDate(''); }}>\n          Limpar\n        </Button>\n      </Box>\n\n      <DataTable\n        columns={columns}\n        data={filteredMovimentacoes}\n        actions={false}\n      />\n    </Layout>\n  );\n};\n\nexport default Estoque;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}